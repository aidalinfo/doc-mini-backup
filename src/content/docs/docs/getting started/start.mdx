---
title: DÃ©marrage
sidebar:
  order: 2
description: DÃ©marrage rapide avec mini backup.
---
import { Aside, LinkCard, CardGrid, FileTree } from '@astrojs/starlight/components';

Pour simplifier lâ€™utilisation de Mini Backup, nous avons conÃ§u une configuration basÃ©e sur **Docker** et **Docker Compose**. Ce guide vous accompagnera pas Ã  pas pour installer et configurer lâ€™outil rapidement.


## PrÃ©requis

Assurez-vous dâ€™avoir installÃ©â€¯:
- **Docker**
- **Docker Compose**

Si ce nâ€™est pas dÃ©jÃ  fait, vous pouvez consulter la documentation officielle de Docker pour les instructions dâ€™installation.

## Installation

En prÃ©requis il faudra donc docker et docker-compose.

En premier nous allons tÃ©lÃ©charger le projet mini-backup-getting-started.

**Wget :**
```bash
wget https://github.com/aidalinfo/mini-backup-getting-started/archive/refs/heads/main.zip \
     -O mini-backup-getting-started.zip
```

**Curl :**
```bash
curl -L https://github.com/aidalinfo/mini-backup-getting-started/archive/refs/heads/main.zip \
     -o mini-backup-getting-started.zip
```

Ensuite, nous allons dÃ©compresser le fichier tÃ©lÃ©chargÃ©.

```bash
unzip mini-backup-getting-started.zip
cd mini-backup-getting-started-main
```

## Explication docker compose

Voici un aperÃ§u des principaux conteneurs dÃ©finis dans le fichier docker-compose.yml.

### minio

Le conteneur Minio simule un serveur S3 pour hÃ©berger vos sauvegardes. Un deuxiÃ¨me conteneur crÃ©e automatiquement un bucket nommÃ© backup.

```yaml
    image: minio/minio
    container_name: minio
    restart: always
    ports:
      - "9000:9000"
      - "9001:9001"
    environment:
      MINIO_ROOT_USER: minioadmin
      MINIO_ROOT_PASSWORD: miniopassword
    volumes:
      - ./minio/data:/data
    command: server /data --console-address ":9001"
    
  createbuckets:
    image: minio/mc
    depends_on:
      - minio
    entrypoint: >
      /bin/sh -c "
      /usr/bin/mc config host add minio http://minio:9000 minioadmin miniopassword;
      /usr/bin/mc rm -r --force minio/backup;
      /usr/bin/mc mb minio/backup;
      /usr/bin/mc policy download minio/backup;
      exit 0;
```
### mini-backup

Ce conteneur inclut la CLI, le serveur et lâ€™API. Lâ€™environnement AUTO_CONFIG gÃ©nÃ¨re automatiquement les fichiers de configuration.

AES KEY est la clÃ© AES utilisÃ©e pour chiffrer les sauvegardes, vous pouvez en gÃ©nÃ©rer une avec la commande ```openssl rand -base64 32```

```yaml
  mini-backup:
    image: rg.fr-par.scw.cloud/open-mini-backup/mini-backup:latest
    container_name: mini-backup
    restart: always
    volumes:
      - ./config:/app/config
    environment:
      - AUTO_CONFIG=true
      - MINIO_ACCESS_KEY=minioadmin
      - MINIO_SECRET_KEY=miniopassword
      - GO_ENV=dev
      - AES_KEY=582e9ffb85124ee9b8cd572927ef671648e9dedd36f5352f755750930a2248d6
```

### frontend et nginx

Lâ€™interface web et le serveur API communiquent via Nginx.

```yaml
  ui-mini-backup:
    image: rg.fr-par.scw.cloud/open-mini-backup/ui-mini-backup:latest
    container_name: ui-mini-backup
    restart: always

  nginx:
    image: nginx:latest
    container_name: nginx
    restart: always
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - mini-backup
      - ui-mini-backup
```
<Aside type="caution" title="Communication">
    Aucune variable d'environment peut Ãªtre dÃ©finie pour le conteneur frontend.
    Nginx expose lâ€™API de Mini Backup sur `localhost/api` pour permettre la communication.
</Aside>

### MariaDB et MongoDB

Des conteneurs MariaDB et MongoDB sont Ã©galement dÃ©finis pour rÃ©aliser des tests avec Mini Backup.

```yaml

  mariadb:
    image: mariadb
    container_name: mariadb
    restart: always
    volumes:
      - ./mariadb/data:/var/lib/mysql
    # ports:
    #   - "3306:3306"
    environment:
      - MARIADB_ROOT_PASSWORD=password
      - MARIADB_DATABASE=superdb
      - MARIADB_USER=user
      - MARIADB_PASSWORD=admin

  mongo:
    image: mongo
    restart: always
    container_name: mongo
    # ports:
      # - 27017:27017
    environment:
      MONGO_INITDB_ROOT_USERNAME: root
      MONGO_INITDB_ROOT_PASSWORD: example
```

## Lancer les conteneurs

Maintenant nous allons faire un ```docker compose up``` pour lancer les conteneurs et gÃ©nÃ©rer les fichiers de configuration.

```bash
docker compose up -d
```

## Configuration

AprÃ¨s le lancement, deux fichiers de configuration seront gÃ©nÃ©rÃ©s dans le dossier configâ€¯:

```bash
âžœ  mini-backup-getting-started-main ls config
config.yaml server.yaml
```

- **config.yaml** : Contient la configuration des backups, y compris les identifiants des bases de donnÃ©es, les chemins de sauvegarde, et les rÃ¨gles de rÃ©tention.
- **server.yaml** : DÃ©finit les endpoints S3 et les paramÃ¨tres du serveur.


<LinkCard
    title="En savoir plus"
    href="/docs/configuration/backup"
    description="Configuration dÃ©taillÃ©e des backups"
/>

Ã‰ditez le fichier server.yaml pour indiquer le nom du bucket S3 et les identifiants de connexion pour hÃ©berger vos sauvegardes.

Voici notre section rstorage aprÃ¨s modification :

```yaml
rstorage:
  minio:
    endpoint: "http://minio:9000"
    bucket_name: "backup"
    access_key: "${{MINIO_ACCESS_KEY}}"
    secret_key: "${{MINIO_SECRET_KEY}}"
    region: "fr-par"
```
<LinkCard
    title="En savoir plus"
    href="/docs/configuration/server"
    description="Configuration dÃ©taillÃ©e du serveur"
/>

Nous allons aussi exposer le port de mongo, afin d'y accÃ©der avec mongo compass et y insÃ©rer des donnÃ©es.

<Aside>Vous pouvez aussi demander Ã  GPT un script pour mysql ou autre, l'objectif est de voir comment restaurer nos donnÃ©es.</Aside>

```yaml
    ports:
      - 27017:27017
```
## VÃ©rification

Une fois les modifications apportÃ©es, relancez les conteneurs :

```bash
docker compose up -d && docker compose restart
```

Consultez les journaux pour vÃ©rifier que tout fonctionne correctement :

```bash
docker logs mini-backup
```

RÃ©sultat :

```
ðŸš€ DEV CONSOLE ðŸš€ -- Successfully compressed backups/mongo-20250122_222200.bson.gz
ðŸš€ DEV CONSOLE ðŸš€ -- [CORE_UTILS] Loading config file: config/server.yaml
ðŸš€ DEV CONSOLE ðŸš€ -- La section [minio] existe dÃ©jÃ  dans le fichier credentials. Aucune modification nÃ©cessaire.
ðŸš€ DEV CONSOLE ðŸš€ -- S3Manager initialized
ðŸš€ DEV CONSOLE ðŸš€ -- Fichier backups/mongo-20250122_222200.bson.gz.enc tÃ©lÃ©versÃ© avec succÃ¨s vers backup/mongo/mongo/mongo-20250122_222200.bson.gz.enc
ðŸš€ DEV CONSOLE ðŸš€ -- Successfully uploaded backups/mongo-20250122_222200.bson.gz.enc to backup
[backups/mongo-20250122_222200.bson.gz]
ðŸš€ DEV CONSOLE ðŸš€ -- Successfully backed up MongoDB for mongo: backups/mongo-20250122_222200.bson.gz
```

Maintenant nous allons crÃ©er une base et un document dans mongo.

![mongo compass](../../../../assets/SCR-20250122-ufbi.png)

Nous voyons que sur l'interface de minio, depuis la crÃ©ation du document, la taille du backup est un peu plus grande.

![minio](../../../../assets/SCR-20250122-uhba.png)

<Aside>L'interface de minio est accessible Ã  l'adresse http://localhost:9001</Aside>

**(Nous avons donc supprimer notre base de donnÃ©es pour tester la restauration)**

## Restauration

Vous pouvez restaurer vos sauvegardes en utilisant soit lâ€™interface web, soit la ligne de commande.

### Web

AccÃ©dez Ã  lâ€™interface de Mini Backup Ã  lâ€™adresse http://localhost/

Sur la page d'accueil, sÃ©lectionnez un backup dans la liste et cliquez sur l'icÃ´ne de restauration.

![restauration](../../../../assets/SCR-20250122-uiph.png)

Un encadrÃ© sâ€™affiche pour confirmer la restauration. Cliquez sur le bouton de restauration pour rÃ©cupÃ©rer vos donnÃ©es.

![restauration](../../../../assets/SCR-20250123-brel.png)
![Notification](../../../../assets/SCR-20250123-brhk.png)

Une fois terminÃ©, vos donnÃ©es seront restaurÃ©es avec succÃ¨sâ€¯!

### Cli 

**ExÃ©cutez la commande suivante pour restaurer la derniÃ¨re version dâ€™un backupâ€¯:**

```bash
docker exec mini-backup /app/backup-cli restore mongo last
```

Cette commande spÃ©cifie le nom du backup (mongo) et utilise le mot-clÃ© last pour rÃ©cupÃ©rer la version la plus rÃ©cente.

**Pour restaurer une version antÃ©rieureâ€¯:**

Il suffit de rajouter -it et de retirer last de la dernier commande.

```bash
docker exec -it mini-backup /app/backup-cli restore mongo
```

Cette commande vous demandera de sÃ©lectionner une version parmi les backups disponibles.


Sortie complÃ¨te :

```bash
docker exec -it mini-backup /app/backup-cli restore mongo
Voulez-vous restaurer le dernier backup pour mongo ? (y/n) : n
ðŸš€ DEV CONSOLE ðŸš€ -- [CORE_UTILS] No config path provided, using default config path
ðŸš€ DEV CONSOLE ðŸš€ -- [CORE_UTILS] Loading config from config/config.yaml
ðŸš€ DEV CONSOLE ðŸš€ -- [CORE_UTILS] Loading config file: config/server.yaml
ðŸš€ DEV CONSOLE ðŸš€ -- La section [minio] existe dÃ©jÃ  dans le fichier credentials. Aucune modification nÃ©cessaire.
ðŸš€ DEV CONSOLE ðŸš€ -- S3Manager initialized
Listing des backups disponibles :
ðŸš€ DEV CONSOLE ðŸš€ -- Liste des backups (prÃ©fixe: 'backup/mongo/mongo'): [backup/mongo/mongo/mongo-20250122_232400.bson.gz.enc backup/mongo/mongo/mongo-20250122_232600.bson.gz.enc backup/mongo/mongo/mongo-20250122_232800.bson.gz.enc backup/mongo/mongo/mongo-20250122_233000.bson.gz.enc backup/mongo/mongo/mongo-20250122_233800.bson.gz.enc backup/mongo/mongo/mongo-20250122_234000.bson.gz.enc backup/mongo/mongo/mongo-20250122_234200.bson.gz.enc backup/mongo/mongo/mongo-20250122_234600.bson.gz.enc backup/mongo/mongo/mongo-20250122_234800.bson.gz.enc backup/mongo/mongo/mongo-20250122_235000.bson.gz.enc backup/mongo/mongo/mongo-20250122_235200.bson.gz.enc backup/mongo/mongo/mongo-20250122_235400.bson.gz.enc]
1. backup/mongo/mongo/mongo-20250122_232400.bson.gz.enc
2. backup/mongo/mongo/mongo-20250122_232600.bson.gz.enc
3. backup/mongo/mongo/mongo-20250122_232800.bson.gz.enc
4. backup/mongo/mongo/mongo-20250122_233000.bson.gz.enc
5. backup/mongo/mongo/mongo-20250122_233800.bson.gz.enc
6. backup/mongo/mongo/mongo-20250122_234000.bson.gz.enc
7. backup/mongo/mongo/mongo-20250122_234200.bson.gz.enc
8. backup/mongo/mongo/mongo-20250122_234600.bson.gz.enc
9. backup/mongo/mongo/mongo-20250122_234800.bson.gz.enc
10. backup/mongo/mongo/mongo-20250122_235000.bson.gz.enc
11. backup/mongo/mongo/mongo-20250122_235200.bson.gz.enc
12. backup/mongo/mongo/mongo-20250122_235400.bson.gz.enc
SÃ©lectionnez un numÃ©ro de backup : 11
ðŸš€ DEV CONSOLE ðŸš€ -- Starting restore process for: mongo, version: mongo-20250122_235200.bson.gz.enc
ðŸš€ DEV CONSOLE ðŸš€ -- [CORE_UTILS] No config path provided, using default config path
ðŸš€ DEV CONSOLE ðŸš€ -- [CORE_UTILS] Loading config from config/config.yaml
ðŸš€ DEV CONSOLE ðŸš€ -- Detected MongoDB restore for mongo
ðŸš€ DEV CONSOLE ðŸš€ -- Starting restore process for: mongo, version: mongo-20250122_235200.bson.gz.enc
ðŸš€ DEV CONSOLE ðŸš€ -- [CORE_UTILS] Loading config file: config/server.yaml
ðŸš€ DEV CONSOLE ðŸš€ -- La section [minio] existe dÃ©jÃ  dans le fichier credentials. Aucune modification nÃ©cessaire.
ðŸš€ DEV CONSOLE ðŸš€ -- S3Manager initialized
ðŸš€ DEV CONSOLE ðŸš€ -- Using specified backup version: mongo-20250122_235200.bson.gz.enc
ðŸš€ DEV CONSOLE ðŸš€ -- Fichier backup/mongo/mongo/mongo-20250122_235200.bson.gz.enc tÃ©lÃ©chargÃ© avec succÃ¨s vers backups/mongo-20250122_235200.bson.gz.enc
ðŸš€ DEV CONSOLE ðŸš€ -- Downloaded encrypted file to: backups/mongo-20250122_235200.bson.gz.enc
ðŸš€ DEV CONSOLE ðŸš€ -- Decrypted file to: backups/mongo-20250122_235200.bson.gz
ðŸš€ DEV CONSOLE ðŸš€ -- No decompression needed for: backups/mongo-20250122_235200.bson.gz
Resultat de la restauration: backups/mongo-20250122_235200.bson.gzðŸš€ DEV CONSOLE ðŸš€ -- Starting MongoDB restore from: backups/mongo-20250122_235200.bson.gz
ðŸš€ DEV CONSOLE ðŸš€ -- MongoDB restore completed successfully from: backups/mongo-20250122_235200.bson.gz
Restauration rÃ©ussie pour mongo (version: mongo-20250122_235200.bson.gz.enc)
```

# Conclusion

Mini Backup est conÃ§u pour vous offrir une solution de sauvegarde simple et efficace, adaptÃ©e Ã  vos besoins. Bien que certaines fonctionnalitÃ©s soient encore en dÃ©veloppement, lâ€™outil vous permet dÃ©jÃ  de gÃ©rer vos backups avec flexibilitÃ© et sÃ©curitÃ©.

Nous travaillons activement Ã  enrichir Mini Backup avec des tutoriels dÃ©taillÃ©s et des configurations dâ€™exemple pour chaque type de sauvegarde. Ces amÃ©liorations seront bientÃ´t disponibles afin de rendre lâ€™expÃ©rience encore plus fluide et complÃ¨te.

N'hÃ©sitez pas Ã  nous faire des retours, et restez Ã  lâ€™Ã©coute pour les prochaines mises Ã  jourâ€¯!